function openCsChatBox(){var csIframe=$("#cs_chat_iframe")[0]
if(csIframe){var data={id:1}
csIframe.contentWindow.postMessage(JSON.stringify(data),"*")}}function mouseUp(){window.removeEventListener("mousemove",divMove,!0)}function mouseDown(e){var div=document.getElementById("cs-live-chat")
csCurrentPosition="right"==csAlign?document.body.clientWidth-e.clientX-parseInt(div.style.right,10):e.clientX-parseInt(div.style.left,10),window.addEventListener("mousemove",divMove,!0)}function divMove(e){var div=document.getElementById("cs-live-chat")
if("right"==csAlign){var newRight=document.body.clientWidth-e.clientX-csCurrentPosition
div.style.right=newRight+"px"}else{var newLeft=e.clientX-csCurrentPosition
div.style.left=newLeft+"px"}}function embedCsChat(data){var iframe=document.createElement("iframe"),div=document.createElement("div"),divDrag=document.createElement("div"),body=document.body,style=window.getComputedStyle(body,null),currentBodyPosition=style.position
console.log(currentBodyPosition)
try{div.id="cs-live-chat",div.style.width="300px",div.style.height="30px",div.style.position="fixed",div.style.bottom="0px",div.style.zIndex=9999999,div.style.overflow="hidden",div.style.margin=0,div.style.padding=0,div.style.border=0,div.style.background="transparent",divDrag.id="cs-div-drag",divDrag.style.width="0px",divDrag.style.height="0px",divDrag.style.position="absolute",divDrag.style.top="0",divDrag.style.zIndex=999,divDrag.style.cursor="-webkit-grab",iframe.id="cs_chat_iframe",iframe.style.border="none",iframe.style.width="100%",iframe.style.height="100%",iframe.style.position="relative",iframe.style.overflow="hidden",iframe.style.margin=0,iframe.style.verticalAlign="text-bottom",iframe.style.backgroundColor="transparent",iframe.style.display="block"
var src="https://3c-web.mobifone.vn:8090/getChatView?key=",username=void 0==data.username?"":data.username,color=void 0==data.color?"":data.color,language=void 0==data.language?"":data.language,email=void 0==data.email?"":data.email,phone=void 0==data.phone?"":data.phone,align=void 0==data.align?"right":"left"==data.align?"left":"right",auto=void 0==data.auto?"1":data.auto,hidePopup=void 0==data.hide?"0":data.hide,pageTitle=""!=document.title?document.title:"",referer=document.referrer
csAlign=align
var queryString="?domain="+data.domain+"&username="+encodeURIComponent(username)+"&color="+color+"&language="+encodeURIComponent(language)+"&email="+encodeURIComponent(email)+"&phone="+encodeURIComponent(phone)+"&auto="+auto+"&hide="+hidePopup+"&pageTitle="+encodeURIComponent(pageTitle)+"&referrer="+encodeURIComponent(referer)
isMobile.any()||"left"!=align?div.style.right="10px":div.style.left="60px",iframe.src=src+encodeURIComponent(btoa(queryString)),isMobile.any()?(iframe.style.position="fixed",iframe.style.zIndex=9999999,iframe.style.bottom="15px",iframe.style.right="20px",iframe.style.width="48px",iframe.style.height="48px",document.body.appendChild(iframe)):(div.appendChild(divDrag),div.appendChild(iframe),document.body.appendChild(div)),divDrag.addEventListener("mousedown",mouseDown,!1),window.addEventListener("mouseup",mouseUp,!1)
var eventMethod=window.addEventListener?"addEventListener":"attachEvent",eventer=window[eventMethod],messageEvent="attachEvent"==eventMethod?"onmessage":"message"
eventer(messageEvent,function(e){var key=e.message?"message":"data",data=e[key],iframe=document.getElementById("cs_chat_iframe")
if("openChatBox"==data){isMobile.any()?(document.body.style.position="fixed",iframe.style.width="100%",iframe.style.height="100%",iframe.style.right="0px",iframe.style.bottom="0px"):(div.style.width="290px",div.style.height="400px",divDrag.style.width="260px",divDrag.style.height="24px"),iframe.style.display="block",div.style.display="block"
var msgifr=iframe.contentWindow
msgifr.postMessage(JSON.stringify({id:2}),"*")}else if("closeChatBox"==data)if(isMobile.any()){currentBodyPosition?document.body.style.position=currentBodyPosition:document.body.style.position="static",iframe.style.width="48px",iframe.style.height="48px",iframe.style.right="20px",iframe.style.bottom="15px"
var url=window.location.href,sub=url.indexOf("http://topmat.vn")
sub>-1&&isMobile.iOS()&&($("#page").css("display","none"),setTimeout(function(){$("#page").css("display","block")},100))}else div.style.width="300px",div.style.height="30px",divDrag.style.width="0px",divDrag.style.height="0px"
else if("closeChatBoxHide"==data)isMobile.any()?(currentBodyPosition?document.body.style.position=currentBodyPosition:document.body.style.position="static",iframe.style.width="48px",iframe.style.height="48px",iframe.style.right="20px",iframe.style.bottom="15px"):(div.style.width="300px",div.style.height="30px",divDrag.style.width="0px",divDrag.style.height="0px"),hidePopup&&(iframe.style.display="none",div.style.display="none")
else if(data.type&&"new_mess_incoming"==data.type){if(!Notification)return
"granted"!==Notification.permission?Notification.requestPermission():(newMessageNotificationChatClient=new Notification(window.location.hostname,{icon:"/images/chat-noti.png",body:data.content,tag:"new-message-incoming"}),setTimeout(function(){newMessageNotificationChatClient.close()},3e3),newMessageNotificationChatClient.onclick=function(){window.focus()})}},!1)}catch(e){iframe.parentNode.removeChild(iframe),currentBodyPosition?document.body.setAttribute("style","position:"+currentBodyPosition):document.body.setAttribute("style","position:static")}}var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPod|iPad/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},csCurrentPosition=0,csAlign="right"
